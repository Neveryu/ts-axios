# 跨域 withCredentials

# XSRF 防御
  XSRF 又名 CSRF，跨站请求伪造，它是前端常见的一种攻击方式。

  用户登陆了网站A，在浏览器上留有网站A的cookie，用户浏览网站B时，网站B向网站A发起了一个请求，并withCredentials:true，带上了网站A的cookie，网站A以为这是一个正常的用户请求。网站B就达到跨站请求攻击的目的了。

  CSRF的防御手段有很多，比如验证请求的 referer，但是 referer也是可以伪造的。所以杜绝此类攻击的一种方式是服务器端要求每次请求都包含一个token，这个token不在前端生成，而是在我们每次访问站点的时候生成，并通过 set-cookie 的方式种到客户端。然后客户端发送请求的时候，从cookie中对应的字段读出token，然后添加到请求 headers 中。这样服务端就可以从请求 headers 中读取这个token并验证。由于这个token是很难伪造的。所以就能区分这个请求是否是用户正常发起的。


对于我们的 ts-axios 库，我们要自动把这几件事做了，每次发送请求的时候，从cookie中读取对应的token值，然后添加到请求headers中。我们允许用户配置xsrfCookieName 和 xsrfHeaderName，其中xsrfCookieName表示存储token的cookie名称，xsrfHeaderName表示请求headers中token对应的header名称。

# 上次和下载的进度监控
有些时候，当我们上传文件或者是请求一个大体积数据的时候，希望知道实时的进度，甚至可以基于此做一个进度条的展示。

# HTTP授权

# axios.all axios.spread
  实际上，axios.all 就是 Promise.all 的封装，它返回的是一个 Promise 数组，then 函数的参数本应是一个参数为 Promise resolves（数组）的函数，在这里使用了 axios.spread 方法。所以 axios.spread 方法是接收一个函数，返回一个新的函数，新函数的结构满足 then 函数的参数结构。

# 单元测试
单元测试是前端一个很重要的方向，鉴别一个开源库是否靠谱的一个标准是它的单元测试是否完善。有了完整的单元测试，未来你去重构现有代码或者是增加新的需求都会有十足的把握不出现 regression bug。

在前面的章节，我们已经编写完成 ts-axios 库的代码，并通过 demo 的形式简单地对一些功能做了验证，但是 demo 可以走到的代码分支，覆盖的场景都是极其有限的。为了用更科学的手段保证我们代码的可靠性，我们需要去编写单元测试，并尽可能达到 99% 以上的测试覆盖率。

这门课我们会使用开源测试框架 Jest，它是 Facebook 出品的一个测试框架，相对其他测试框架，它的一大特点就是内置了常用的测试工具，比如自带断言、测试覆盖率工具，实现了开箱即用。

由于时间有限，我不会带大家一行行手敲测试代码，但我会把所有的知识点和测试代码都带大家过一遍，确保大家都能够学会。但是我希望你们在学习的过程中，能自己手敲这些测试代码，这样有助于你们学习和巩固。

# Jest安装
